"use strict";(function(n){const t=function(){n(".js-fullheight").css("height",n(window).height());n(window).resize(function(){n(".js-fullheight").css("height",n(window).height())})};t();n(".sidebar-collapse").on("click",function(){n("#sidebar").toggleClass("active")});n("body").on("click",".page-link",function(t){t.preventDefault();n("#page").val(n(this).attr("data-val"));fetchData()});n("#logCount").on("change",function(){n("#page").val("1");fetchData()});n("#logFilter").on("change",function(){n("#page").val("1");fetchData()});n("#submit").on("click",function(){n("#page").val("1");fetchData()});n("body").on("click",".modal-trigger",function(t){t.preventDefault();const u=n("#messageModal"),r=u.find(".modal-body"),f=n(this).attr("data-type");let i=n(this).find("span").text();if(f==="xml")i=n(this).find("span").html(),i=formatXml(i,"  "),n(r).removeClass("wrapped");else if(f==="json"){const t=JSON.parse(i);i=JSON.stringify(t,null,2);n(r).removeClass("wrapped")}else n(r).addClass("wrapped");r.find("pre").text(i);u.modal("show");n(".stacktrace").netStack({prettyprint:!0})});n("#saveJwt").on("click",function(){const t=n(this).data("saved");if(t.toString()==="false"){const t=n("#jwtToken").val();if(!t)return;sessionStorage.setItem("serilogui_token",t);n("#jwtToken").remove();n("#tokenContainer").text("*********");n(this).text("Clear");n(this).data("saved","true");n("#jwtModalBtn").find("i").removeClass("fa-unlock").addClass("fa-lock");fetchData();return}sessionStorage.removeItem("serilogui_token");n(this).text("Save");n(this).data("saved","false");n("#tokenContainer").html('<input type="text" class="form-control" id="jwtToken" autocomplete="off" placeholder="Bearer eyJhbGciOiJSUz...">');n("#jwtModalBtn").find("i").removeClass("fa-lock").addClass("fa-unlock")})})(jQuery);let authType;const routePrefix={url:"",set setUrl(n){this.url=n}},init=n=>{n.authType==="Jwt"?initTokenUi():($("#jwtModalBtn").remove(),sessionStorage.removeItem("serilogui_token")),authType=n.authType,routePrefix.setUrl=n.routePrefix,fetchData()},fetchData=()=>{const i=$("#logTable tbody"),u=$("#page").val(),f=$("#count").children("option:selected").val(),e=$("#level").children("option:selected").val(),n=$("#startDate").val(),t=$("#endDate").val();if(n&&t!==null){const i=Date.parse(n),r=Date.parse(t);if(i>r){alert("Start date cannot be greater than end date");return}}const o=escape($("#search").val()),s=`${location.pathname.replace("/index.html","")}/api/logs?page=${u}&count=${f}&level=${e}&search=${o}&startDate=${n}&endDate=${t}`,h=sessionStorage.getItem("serilogui_token");let r=null;authType!=="Windows"?$.ajaxSetup({headers:{Authorization:h}}):r={withCredentials:!0};$.get({url:s,xhrFields:r,success:function(n){$("#totalLogs").html(n.total);$("#showingItemsStart").html(n.page);$("#showingItemsEnd").html(n.count);$(i).empty();n.logs.forEach(function(n){let t="";n.exception!=undefined&&(t=`<a href="#" title="Click to view" class="modal-trigger" data-type="text">
                        View <span style="display: none">${n.exception}</span>
                    </a>`);const r=`<tr class="${n.level}">
                <td class="text-center">${n.rowNo}</td>
                <td class="text-center"><span class="log-level text-white ${levelClass(n.level)}">${n.level}</span></td>
                <td class="text-center">${formatDate(n.timestamp)}</td>
                <td class="log-message">
                    <span class="overflow-auto"><truncate length="100">${truncateString(n.message,100)}</truncate></span>
                </td>
                <td class="text-center">
                    ${t}
                 </td>
                <td class="text-center">
                    <a href="#" class="modal-trigger" title="Click to view" data-type="${n.propertyType}">
                    View
                        <span style="display: none">${n.properties}</span>
                    </a>
                </td>
            </tr>`;$(i).append(r)});paging(n.total,n.count,n.currentPage)}}).fail(function(n){if(n.status===403)console.log(n),alert("You are not authorized you to access logs.\r\nYou are not logged in or you don't have enough permissions to perform the requested operation.");else if(n.status===500){const t=JSON.parse(n.responseJSON.errorMessage);alert(t.errorMessage)}else alert(n.responseText)})},levelClass=n=>{switch(n){case"Verbose":case"Debug":return"bg-success";case"Information":return"bg-primary";case"Warning":return"bg-warning";case"Error":return"bg-danger";default:return""}},formatDate=n=>{var t=new Date(n);return`${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getDate().toString().padStart(2,"0")}/${t.getFullYear().toString().padStart(4,"0")}
            ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}:${t.getSeconds().toString().padStart(2,"0")}.${t.getMilliseconds().toString()}`},truncateString=(n,t)=>{if(n.length<=t)return n;const i=n.slice(0,t)+"...";return`<a href="#" title="Click to view" class="modal-trigger" data-type="text">
                    ${i}
                    <span style="display: none">${n}</span>
                  </a>`},formatXml=(n,t)=>{var r="",i="";return t=t||"\t",n.split(/>\s*</).forEach(function(n){n.match(/^\/\w/)&&(i=i.substring(t.length));r+=i+"<"+n+">\r\n";n.match(/^<?\w[^>]*[^\/]$/)&&(i+=t)}),r.substring(1,r.length-3)},paging=(n,t,i)=>{const o=5,r=Math.ceil(n/t);let f,e;r<=o?(f=1,e=r):r===i?(f=r-o,e=r):(f=i,e=i-1+o);const s=r>1&&f>1,h=r>o&&e!==r,u=$("#pagination");if($(u).empty(),s){const n=i-1;$(u).append(`<li class="page-item first"><a href="#" data-val="1" tabindex="${n}" class="page-link">First</a></li>`);$(u).append(`<li class="page-item previous"><a href="#" data-val="${n}" tabindex="${n}" class="page-link">Previous</a></li>`)}for(let n=f;n<=e;n++)i===n?$(u).append(`<li class="page-item active"><span data-val="${n}" class="page-link disabled">${n} <span class="sr-only">(current)</span></span></li>`):$(u).append(`<li><a href="#" data-val="${n}" tabindex="${n}" class="page-link">${n}</a></li>`);if(h){const n=i+1;$(u).append(`<li class="page-item ">&nbsp;...&nbsp;</li>`);$(u).append(`<li class="page-item next"><a href="#" data-val="${n}" tabindex="${n}" class="page-link">Next</a></li>`);$(u).append(`<li class="page-item previous"><a href="#" data-val="${r}" tabindex="${n}" class="page-link">Last</a></li>`)}},initTokenUi=()=>{const n=sessionStorage.getItem("serilogui_token");n&&($("#jwtToken").remove(),$("#tokenContainer").text("*********"),$("#saveJwt").text("Clear").data("saved","true"),$("#jwtModalBtn").find("i").removeClass("fa-unlock").addClass("fa-lock"))};